{{define "create-initial-ramdisk"}}
## Create initial ramdisk

First, edit `/etc/mkinitcpio.conf`. Order is important.

{{if eq . "TigerLake"}}
Add `i915` for Intel graphics for [early KMS](https://wiki.archlinux.org/title/Kernel_mode_setting#Early_KMS_start).

```diff
MODULES=(i915)
```
{{end}}

Add the `encrypt` hook so we can unlock the LUKS partition.

```diff
-HOOKS=(base udev autodetect modconf block filesystems keyboard fsck)
+HOOKS=(base udev autodetect modconf block encrypt filesystems keyboard fsck)
```

{{if eq . "TigerLake"}}
Next add this to `/etc/modprobe.d/i915.conf`.
See [Enable GuC / HuC firmware loading](https://wiki.archlinux.org/title/intel_graphics#Enable_GuC_/_HuC_firmware_loading).

```
options i915 enable_guc=3
options i915 enable_fbc=1
options i915 fastboot=1
```
{{end}}

Build the image.

```
mkinitcpio -p linux
```
{{end}}
